<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PROFINET Device: Example Project Description</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PROFINET Device
   &#160;<span id="projectnumber">v2.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('example_project.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example Project Description </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="program_flow"></a>
Program Flow</h1>
<p><img src="profinet_example_control_flow.png" alt="Application control flow" height="500px" border="1" class="inline"/></p>
<h1><a class="anchor" id="program_main"></a>
Program Main Routine</h1>
<h2><a class="anchor" id="program_init"></a>
Program Initialization</h2>
<ol type="1">
<li>The Program Main Routine at first is Initializing the Operating System in #System_init(), as well as the required Hardware Interface Drivers in #Board_Init().</li>
<li>Next The KUNBUS Abstraction Layers are being initialized.</li>
</ol>
<h3><a class="anchor" id="stack_init"></a>
Stack Initialization</h3>
<p>The Stack Initialization is done within #App_taskStackMain()</p>
<p>APP_stackInit </p><pre class="fragment">-# APP_HW_BOARD_INFO_read
    -# APPL_UI_getMacAddr
    -# PRU_PN_loadPru
</pre><h3><a class="anchor" id="stack_configuration"></a>
Stack Configuration</h3>
<p>APP_configureStack </p><pre class="fragment">    -# APPL_initPermStorage
    -# PN_API_PDEV_init
            -#
    -# APP_config_Pdev
            -# Readback Serial Number, Hardware Revision, Software Revision
            -# apply vendor and device id
            -# apply chassisId 
            -# apply configuration
    -# APP_configEth
            -# APPL_getPermStorage
            -# DcpData provided to permanent Data
            -# register callbacks within configuration
            -# PN_API_ETH_applyConfiguration (&amp;configuration)
    -# APP_configSnmp
            -# Setup Interface and Port Description Port 1 &amp; 2
            -# PN_API_SNMP_applyConfiguration
    -# APP_configDev
            -# PN_API_DEV_setOutputDataBuffer
            -# PN_API_DEV_setInputDataBuffer
            -# APP_configureSubmodules
                    -# PN_API_DEV_registerModuleSubstitutes - DAP
                    -# PN_API_DEV_registerModuleSubstitutes - Default Module
                    -# PN_API_DEV_registerModuleSubstitutes - Default SubModule
                    -# Plug Module &amp; Submodules Slot 0 DAP Slot 1 - 9 Input Slot 10 - 18 Output
            -# APP_configureImData
            -# PN_API_DEV_registerWriteRecordIndicatedCallback
            -# PN_API_DEV_applyEquipmentConfiguration
    -# PN_API_PDEV_start
            -# #PN_API_PDEV_APP_start
            -# #PN_API_ETH_APP_start
            -# #PN_API_IP_APP_start
            -# #PN_API_SNMP_APP_start
            -# #PN_API_DEV_APP_start
    -# APP_pruStart
</pre><ol type="1">
<li>The application configures the Slots, Subslots, possibly plugged Modules and Submodules (Substitutes).</li>
<li>Next the application plugs existing Modules and Submodules.<ol type="a">
<li>This example application is configuring a PROFINET device having 19 Slots.</li>
</ol>
</li>
<li>Into Slot 0 the application plugs the Device Access Point Module.<ol type="a">
<li>This Module is getting 4 Submodules plugged.</li>
<li>This Module is used to identify the device and does not have any cyclic Input or Output Process Data mapped.</li>
</ol>
</li>
<li>In Slots 1 to 18 there are Modules and Submodules plugged reflecting cyclic Process Data.<ol type="a">
<li>Within those Slots there are Modules plugged having one Submodule each.</li>
<li>Slot 1 to 9 Input Data Modules and Submodules are plugged.<ol type="i">
<li>Submodules plugged in Slot 1 and 2 reflect 16 Byte Input Data each</li>
<li>Submodules plugged in Slot 3 to 6 reflect 32 Byte Input Data each</li>
<li>Submodules plugged in Slot 7 to 9 reflect 64 Byte Input Data each</li>
</ol>
</li>
<li>Slot 10 to 18 Output Data Modules and Submodules are plugged.<ol type="i">
<li>Submodules plugged in Slot 10 and 11 reflect 16 Byte Input Data each</li>
<li>Submodules plugged in Slot 12 to 15 reflect 32 Byte Input Data each</li>
<li>Submodules plugged in Slot 16 to 18 reflect 64 Byte Input Data each</li>
</ol>
</li>
<li>Plugging a Module/Submodule always follows the same routine<ol type="i">
<li>The Module Descriptor content is erase to avoid dirt effects</li>
<li>The Module Descriptor is filled with<ol type="A">
<li>an Application Process Identifier (API)</li>
<li>a Module Identifier (ID)</li>
<li>a Module Type</li>
<li>its' possible substitutes</li>
</ol>
</li>
<li>the Module is plugged</li>
<li>The Generation of a Submodule follows the Module Generation and Plugging</li>
<li>The Submodule Descriptor is filled with<ol type="A">
<li>Application Process Identifier</li>
<li>Submodule Identifier</li>
<li>Submodule Type</li>
<li>Process Data Parameter, like input data length and offset within the Input Data Buffer, output data length and offset within the Output Data Buffer</li>
<li>its' possible substitutes</li>
</ol>
</li>
<li>The Submodule is plugged</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="profinet_example_project_plug_modules.gif" alt="" height="auto" border="1" class="inline"/></p>
<ol type="1">
<li>When Submodules are plugged, one can assign I&amp;M Data to those<ol type="a">
<li>Our Stack support so called I&amp;M Carriers<ol type="i">
<li>Within the I&amp;M Carrier the I&amp;M Data supported is specified,</li>
<li>the Application Process Identifier, Slot and Subslot, Device and Module Representative assignment is done - this data is provided by I&amp;M Carrier Descriptor</li>
<li>the I&amp;M Carrier Framework currently supports I&amp;M Data of I&amp;M0 to I&amp;M4</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="profinet_example_iam_data.gif" alt="" height="auto" border="1" class="inline"/></p>
<h3><a class="anchor" id="stack_leds"></a>
Stack Status LEDs</h3>
<p>APP_startLedTask</p>
<p>Next the application itself will be executed - this is the time when the device setup is completed and the application can be flagged ready for application relation establishment.</p>
<h3><a class="anchor" id="stack_execution"></a>
Stack and Example Application Execution</h3>
<p>In #APPL_runStack there are two actions performed, the stack execution and the example application code.</p>
<ol type="1">
<li>The stack is periodically triggered by <a class="el" href="group___p_n___a_p_i___p_d_e_v_ga952cd15569b2aa2ca6ac3549ac94fed3.html#ga952cd15569b2aa2ca6ac3549ac94fed3" title="Run physical device, ethernet interface, ip stack, and IO device.">PN_API_PDEV_run</a>.</li>
<li>Next the current Output Data Buffer and the latest Input Data Buffer sent is read back from the stack. The Output Data Buffer is read back by calling <a class="el" href="group___p_n___a_p_i___d_e_v_ga8c2d85d6f1884de354bcd64eb3a2f909.html#ga8c2d85d6f1884de354bcd64eb3a2f909" title="Get buffer of output data triple buffer of IO device with last written output data.">PN_API_DEV_getBufferOutputData</a>. The Input Data Buffer is read back by calling <a class="el" href="group___p_n___a_p_i___d_e_v_gabb5eaefdc1bf4024c05b380e3998ef2a.html#gabb5eaefdc1bf4024c05b380e3998ef2a" title="Get buffer of input data triple buffer of IO device for next to be written input data.">PN_API_DEV_getBufferInputData</a>.</li>
<li>The example application within the PROFINET example project is mapping/mirroring Byte 0 of Output Data Buffer onto Byte 0 of Input Data Buffer. Additionally, an unsigned 8bit integer counter is incremented and written to Byte 1 of Input Data Buffer.</li>
<li>After the example application code is executed the updated Input Data Buffer is released by <a class="el" href="group___p_n___a_p_i___d_e_v_ga7686028cd50c515ea2ddd1e699df583a.html#ga7686028cd50c515ea2ddd1e699df583a" title="Release buffer of input data triple buffer of IO device.">PN_API_DEV_releaseBufferInputData</a>.</li>
</ol>
<p><img src="profinet_example_project.gif" alt="" height="auto" border="1" class="inline"/></p>
<h2><a class="anchor" id="data_exchange_cyclic"></a>
Cyclic Data Exchange</h2>
<p>The Process Data is realized in two separate Triple Buffers for Input and Output Data. The Stack is exchanging the Process Data with the PRU Subsystem and therefore the PROFINET Network cyclically based on the Settings applied in the PLC Program.</p>
<p><img src="profinet_example_project_plus_pru.gif" alt="" height="auto" border="1" class="inline"/></p>
<h2><a class="anchor" id="data_exchange_acyclic"></a>
Acyclic Data Exchange</h2>
<p>In addition to the cyclic data exchange of process input/output data PROFINET uses acyclic data communication to exchange parameter data or network management data between IO-Controller and IO-Devices. The following acyclic data communication is implemented in the example application: </p><ul>
<li>
I&amp;M0…I&amp;M4 data: Identification &amp; Maintenance data like device name, location in the factory, maintenance information for a device can be read and written to a device. </li>
<li>
Port Data Check </li>
<li>
Port Data Adjust </li>
<li>
SNMP data: The Simple Network Management Protocol is used together with the Link Layer Discovery Protocol (LLDP) to do neighborhood discovery and network management in PROFINET networks. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
